<!DOCTYPE html>
<!--[if IE 8]>         <html class="ie8"> <![endif]-->
<!--[if IE 9]>         <html class="ie9"> <![endif]-->
<!--[if gt IE 9]><!--> <html> <!--<![endif]-->
<head>
    <title class="Test"></title>
    <meta charset="UTF-8">
    <link href="style.css" rel="stylesheet">
</head>
<body style="padding:0;margin:0">
    <div id="id-start_slide" class="wrapper">
        <div class="back_start" data-app-property="backgroundColor,showBackgroundImage"></div>
        <!--<div class="shadow"></div>-->
        <div class="slide">
            <div class="cnt_wr">
                <div class="start_txt">
                    <h2 id="id-start_header_text" data-app-property="startHeaderText,startHeaderPaddingTop,startHeaderPaddingBottom" class="js-startHeader start_head"></h2>
                    <span id="id-start_desc_text" data-app-property="startDescription" class="start_desc">Проверь свои знания в географии</span>
                </div>
                </br>
                <div class="btn_wr" data-app-property="buttonBackgroundColor,buttonHoverBackgroundColor,buttonFontColor,buttonHoverFontColor,buttonBorderColor,buttonHoverBorderColor,buttonBorderRadius,buttonFontSize,buttonFontFamily">
                    <span class="t_btn js-next">Начать</span>
                </div>
            </div>
        </div>
        <div class="logo js-logo js-start_logo" data-app-property="logoStartPosition,logoUrl"></div>
    </div>

    <div class="js-slides_cnt">
        <!-- Слайды с вопросами добавлятся программно сюда -->
    </div>

    <div id="id-end_slide">
        <!-- Сюда добавляется один из результатов. Который собирается из шаблона. -->
    </div>

    <script type="text/javascript" src="utils.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <script id="id-slide_text_template" type="text/template">
        <div class="wrapper">
            <div class="back_start"></div>
            <!--<div class="shadow"></div>-->
            <div class="slide js-slide">
                <div class="cnt_wr">
                    <div class="q_wr">
                        <span data-app-property="quiz.{{currentQuestion}}.text">{{question_text}}</span>
                    </div>
                    <div data-app-property="quiz.{{currentQuestion}}.options" class="js-answers_cnt">
                        <!-- Сюда программно добавляются варианта ответов -->
                    </div>
                    <div class="js-explain explain_blk" style="display:none;">
                        <div class="js-explanation_text"></div>
                        <div><span class="t_btn js-next">Далее</span></div>
                    </div>
                </div>
            </div>
            <div data-app-property="topColontitleText" class="topColontitle">Верхний колонтитул</div>
            <div data-app-property="questionProgressPosition" class="js-question_progress question_progress"></div>
        </div>
    </script>
    <script id="id-slide_photo_template" type="text/template">
        <div class="wrapper">
            <div class="back_start"></div>
            <!--<div class="shadow"></div>-->
            <div class="slide js-slide">
                <div class="cnt_wr" style="margin-top: 30px;">
                    <div class="q_wr __photo">
                        <span data-app-property="quiz.{{currentQuestion}}.text">{{question_text}}</span>
                    </div>
                    <div class="photo_wr js-photo" data-app-property="quiz.{{currentQuestion}}.img">
                        <!-- Сюда ставится фото через background так как там есть более удобный алгоритм размещения -->
                    </div>
                    <div data-app-property="quiz.{{currentQuestion}}.options" class="js-answers_cnt">
                        <!-- Сюда программно добавляются варианта ответов -->
                    </div>
                    <div class="js-explain explain_blk" style="display:none;">
                        <div class="js-explanation_text"></div>
                        <div><span class="t_btn js-next">Далее</span></div>
                    </div>
                </div>
            </div>
            <div data-app-property="topColontitleText" class="topColontitle">Верхний колонтитул</div>
            <div data-app-property="questionProgressPosition" class="js-question_progress question_progress"></div>
        </div>
    </script>
    <script id="id-answer_template" type="text/template">
        <!-- TODO: Атрибут есть во вью, а appProperty нет. Так как это нужно для связи DeleteQuickButton. Пока ничего лучше не придумал -->
        <div class="a_wr js-answer js-answer_text" data-app-property="quiz.{{currentQuestion}}.options.{{currentOption}}">
            <div class="a_text">
                <div class="bullit"></div>
                <span data-app-property="quiz.{{currentQuestion}}.options.{{currentOption}}.text" class="txt">{{answer_options_text}}</span>
            </div>
        </div>
    </script>
    <script id="id-result_template" type="text/template">
        <div class="wrapper">
            <div class="back_start"></div>
            <!--<div class="shadow"></div>-->
            <div class="slide">
                <div class="cnt_wr">
                    <div class="start_txt">
                        <h2 class="start_head js-result_title" data-app-property="results.{{currentResult}}.title">Конец</h2>
                        <span class="start_desc js-result_description" data-app-property="results.{{currentResult}}.description">Ты ответил на все вопросы</span>
                    </div>
                    </br>
                    <div class="btn_wr">
                        <span data-app-property="restartButtonText" class="t_btn js-next js-restart">Заново</span>
                    </div>
                </div>
            </div>
            <div class="logo js-logo js-result_logo" data-app-property="logoResultPosition,logoUrl"></div>
        <div>
    </script>
    <script>
        /**
         * Например, можно объявить такой конфиг в контексте window страницы.
         * Engine будет иметь возможность редактировать данные через этот интерфейс
         *
         * Здесь можно описать свойства типа ключ-значение, которые будут влиять на поведение теста
         *
         * На основани объекта app будут построены settings продукта. То, что можно редактировать.
         *
         * @type {object}
         */
        var app = {
            startHeaderText: 'Тест по географии',
            startHeaderPaddingTop: 0,
            startHeaderPaddingBottom: 0,
            startDescription: 'Проверь свои знания в географии',
            restartButtonText: 'Заново',
            randomizeQuestions: false,
            randomizeOptions: false,
            backgroundColor: '#aaa',
            fontColor: '#fff',
            fontFamily: 'Arial',
            showBackgroundImage: true,
            background: 'url(https://s3.eu-central-1.amazonaws.com/proconstructor/facebook-902609146442342/test1/i/Globe7.jpg)',

            /**
             * Логотип бренда, размещенный в тесте. Лого один, но позиции на разных экранах могут быть различные
             *
             */
            logoUrl: 'https://s3.eu-central-1.amazonaws.com/proconstructor/res/thumb_logo.jpg',
            logoStartPosition: {
                left: 10,
                top: 320
            },
            logoResultPosition: {
                left: 10,
                top: 320
            },

            /**
             * Цвет фона кнопки, всех кнопок в приложении
             */
            buttonBackgroundColor: '#fff',
            buttonHoverBackgroundColor: 'hsla(154,48%,54%,1)',
            buttonFontColor: '#000',
            buttonHoverFontColor: '#000',
            buttonBorderColor: '#fff',
            buttonHoverBorderColor: '#fff',
            buttonBorderRadius: '20',
            buttonFontSize: '18',
            buttonFontFamily: 'Arial',

            /**
             * Показывать ли прогресс вопросов, например '2/5'
             */
            showQuestionProgress: true,
            questionProgressFontSize: 20,
            questionProgressFontColor: '#eee',
            questionProgressFontFamily: 'Arial',
            questionProgressPosition: {
                left: 10,
                top: 10
            },

            /**
             * Буллиты вопросов
             */
            showBullits: true,
            bullitsBorderColor: '#fff',
            bullitsBorderWidth: 2,
            bullitHoverBorderWidth: 4, // при наведении на весь вопрос

            /**
             * Верхний колонтитул
             *
             */
            showTopColontitle: true,
            topColontitleText: 'Тест на знание географии',
            topColontitleLineColor: '#333',
            topColontitleBackgroundColor: '#eee',
            topColontitleFontColor: '#000',

            /**
             * Будет показано объяснения, если оно указано для вопроса.
             * Причем есть возможность указать explanation для вопроса, так и для варианта ответа (option)
             * Приоритетнее: для варианта ответа, а потом уже (если есть) для всего вопроса
             */
            showExplanation: true,
            /**
             * Вопросы с ответами
             */
            quiz: [
                {
                    uiTemplate: 'id-slide_text_template',
                    text: 'Мадагаскар -- это где?',
                    options: [
                        {
                            text: 'Страна на западе Африки',
                            type: 'text',
                            explanation: 'Это страна, но не на западе.'
                        },
                        {
                            text: 'Остров в Атлантическом океане',
                            type: 'text',
                            explanation: 'Остров, но не в Атлантике.'
                        },
                        {
                            text: 'Остров на юге Африки',
                            type: 'text',
                            points: 1,
                            explanation: 'Да, верно'
                        }
                    ],
                    explanation: 'Конечно, это остров на юге Африки в индийском океане.'
                },
                {
                    uiTemplate: 'id-slide_photo_template',
                    text: 'Текст фото вопроса?',
                    //TODO base64 data
                    img: 'http://localhost:63342/ProCo/products/test/i/picture1.jpg',
                    options: [
                        {
                            text: 'Вариант ответа 1',
                            points: 1
                        },
                        {
                            text: 'Вариант ответа 2'
                        }
                    ],
                    explanation: 'Пояснение к ответу'
                },
                {
                    uiTemplate: 'id-slide_text_template',
                    text: 'Какая самая большая страна?',
                    options: [
                        {
                            text: 'Гренландия'
                        },
                        {
                            text: 'Россия',
                            points: 1
                        },
                        {
                            text: 'Австралия'
                        }
                    ],
                    explanation: 'Это Россия, все знают.'
                },
                {
                    uiTemplate: 'id-slide_text_template',
                    text: 'Какого моря не существует?',
                    options: [
                        {
                            text: 'Черное море'
                        },
                        {
                            text: 'Синее море',
                            points: 1
                        },
                        {
                            text: 'Красное море'
                        },
                        {
                            text: 'Желтое море'
                        }
                    ]
                }
            ],

            /**
             * Описание результатов, которые можно получить
             * Результаты рассчитываются динамически. Сколько вопросов столько и результатов
             */
            results: [],
//            results: [
//                {
//                    minPoints: 0,
//                    maxPoints: 1,
//                    d__title: 'editable=true;ui=TextQuickInput;',
//                    title: 'Новичок',
//                    d__description: 'editable=true;ui=TextQuickInput;',
//                    description: 'Неплохо для начала.'
//                },
//                {
//                    minPoints: 2,
//                    maxPoints: 3,
//                    d__title: 'editable=true;ui=TextQuickInput;',
//                    title: 'Средний',
//                    d__description: 'editable=true;ui=TextQuickInput;',
//                    description: 'Уже лучше, давай ещё'
//                }
//            ],
//            d__results: 'editable=true;',

            // шаблон текстового вопроса
            proto__text_slide: {
                uiTemplate: 'id-slide_text_template',
                text: 'Текст вопроса?',
                options: [
                    {
                        text: 'Вариант ответа 1',
                        points: 1
                    },
                    {
                        text: 'Вариант ответа 2'
                    }
                ],
                explanation: 'Пояснение к ответу'
            },

            // шаблон фото вопроса
            proto__photo_question_slide: {
                uiTemplate: 'id-slide_photo_template',
                text: 'Текст фото вопроса?',
                img: 'http://localhost:63342/ProCo/products/test/i/picture1.jpg',
                options: [
                    {
                        text: 'Вариант ответа 1',
                        points: 1
                    },
                    {
                        text: 'Вариант ответа 2'
                    }
                ],
                explanation: 'Пояснение к ответу'
            },

            proto__option_text: {
                text: 'Вариант ответа'
            }
        };
        /**
         * Экраны приложения;
         * Настраивает разработчика на то, чтобы сразу работать с экранами
         * Обязательное свойство, любое промо-приложение обладает конечным списком экранов.
         * {
         *      id: {string},
         *      view: {HTMLDOMElement | string | jQueryHTMLDOMElement},
         *      data: {*}
         * }
         */
        var screens = [];
        /**
         * тайтл результата по умолчанию
         */
        var DEF_RESULT_TITLE = 'Конец теста';
        /**
         * Описание результата по умолчанию
         */
        var DEF_RESULT_DESCRIPTION = 'Ты ответил на все вопросы';
        /**
         *
         */
        var resultPoints = 0;
        var currentQuestionIndex = -1;
        /**
         * Id опции, которую выбрал пользователь
         */
        var currentOptionId = '';
        var state = undefined; //'welcome', 'test', 'final'
        /**
         * {Object} Результат, полученный пользователем. Из массива app.results
         */
        var currentResult = null;
        /**
         * Ссылка на движок, сохраняется если была передана в start
         */
        var engineInstance = null;
        /**
         * Режим предпросмотра экранов. То есть приложение не запущено по настоящему. (?)
         * Активируется при вызове функции showScreen
         */
        var previewMode = false;

        function next() {
            //TODO на основе модели переходов можно построить блок схему для пользователя (если лучше формализовать модель)
            if (previewMode === false) {
                switch (state) {
                    case 'welcome': {
                        resultPoints = 0;
                        currentResult = null;
                        // перемещать вопросы при переходе к тесту
                        if (app.randomizeQuestions === true) {
                            shuffle(app.quiz);
                        }
                        $('.js-explain').hide();
                        // currentQuestionIndex устанавливается внутри
                        renderQuestion(0);
                        $('#id-start_slide').hide();
                        $('.js-slides_cnt').show();
                        state = 'test';
                        break;
                    }
                    case 'test': {
                        if (currentQuestionIndex < app.quiz.length-1) {
                            renderQuestion(++currentQuestionIndex);
                        }
                        else {
                            // конец теста, финальный скрин
                            $('.js-slides_cnt').hide();
                            //TODO посчитать результат
                            currentResult = getResultByPoints(resultPoints);
                            renderResult(currentResult);
                            $('#id-end_slide').show();
                            state = 'final';
                        }
                        break;
                    }
                    case 'final': {
                        $('#id-end_slide').hide();
                        $('#id-start_slide').show();
                        state = 'welcome';
                        break;
                    }
                    default: {
                        state = 'welcome';
                        $('#id-start_slide').show();
                        $('#id-end_slide').hide();
                        $('.js-slides_cnt').hide();
                    }
                }
            }
        }

        $('.js-next').click(function() {
            next();
        });

        /**
         * Найти результат в массиве app.results для указанного количества баллов.
         * @param points - количество баллов, для которых найти результат
         */
        function getResultByPoints(points) {
            for (var i = 0; i < app.results.length; i++) {
                var r = app.results[i];
                if (r.minPoints <= points && points <=r.maxPoints) {
                    return r;
                }
            }
            return null;
        }

        /**
         *
         */
        function updateResults() {
            for (var i = 0; i < app.quiz.length; i++) {
                // если такого результата не существует, то создать.
                // это может случиться после добавления нового вопроса в тест
                if (!app.results[i]) {
                    // этот результат значит "ответил правильно на i вопросов"
                    app.results[i] = {
                        minPoints: i,
                        maxPoints: i+1,
                        title: 'Название результата ' + (i+1),
                        description: 'Неплохо для начала.'
                    };
                }
            }
            //TODO при удалении соответственно надо уменьшить количество результатов
        }

        /**
         * Автотесты, описанные разработчиком промо-прототипа. Свойство 'test' является обязательным.
         * Это массив функций, каждая из которых производит проверки.
         * Рекомендуется в рамках ондной функции реализовать одну логическую проверку.
         *
         * Функция должна принимать параметр 'app' - свойства приложения.
         * Важно: не использовать параметры window.app, а пользоваться параметром
         *
         * Для выполнения проверок пользоваться функцией engine.test(actual, expected, message)
         */
        var tests = [
            //TODO можно универсальные сделать тесты для любого проекта на проверку app
                //корректные дескрипторы
                //наличие app tests start
                //

            /**
             * Минимальный результат меньше максимального
             * @returns {boolean}
             */
            function resultMinMax(app, engine) {
                for (var i = 0; i < app.results.length; i++) {
                    var r = app.results[i];
                    if (r.minPoints <= r.maxPoints) {
                        // QUnit included
                        engine.test(r.minPoints <= r.maxPoints, true, 'Минимальный результат меньше максимального');
                    }
                }
            },
            /**
             * Вопросов должно быть хотя бы 1 штука
             */
            function questionsCount(app, engine) {
                engine.test(questions.length > 0, true, 'Вопросов должно быть хотя бы 1 штука');
            },

            function test1(app, engine) {
                engine.test(typeof app.randomizeQuestions == "boolean", true, 'true or false');
            },

            function test2(app, engine) {
                engine.test(typeof app.background == 'string', true, 'background string url');
            }
        ];

        /**
         * Метод, который должен быть определен обязательно
         * После обновления 'app' этот метод должен сделать всё нужное, чтобы приложение работало нормально.
         * Обычно start зовется и после загрузки html страницы в первый раз.
         *
         * @param {object} [params.engine] - когда проект запускается движком сюда будет передана ссылка на движок
         */
        function start(params) {
            // параметры от движка
            if (params && params.engine) {
                engineInstance = params.engine;
            }

            // инициализация по параметрам app
            applyStyles(app);
            $('#id-start_header_text').text(app.startHeaderText);
            $('#id-start_desc_text').text(app.startDescription);

            // подготавливаем экраны
            screens = [];
            screens.push({
                id: 'startScr',
                view: $('#id-start_slide'),
                data: {},
                name: 'Стартовый экран',
                doWhenInDOM: applyStyles
            });
            for (var i = 0; i < app.quiz.length; i++) {
                screens.push({
                    id: 'quizScr'+i,
                    view: renderQuestion(i),
                    // во view есть такие строки data-app-property="quiz.{{currentQuestion}}.text"
                    // data нужно для того, чтобы отрендерить это
                    data: {
                        currentQuestion: i
                    },
                    group: 'questions',
                    name: 'Вопросы',
                    doWhenInDOM: applyStyles
                });
            }

            // обновить количество результатов исходя из нового количества вопросов
            updateResults();

            for (var i = 0; i < app.results.length; i++) {
                // каждый резльтат считается отдельным экраном. Так проще управлять результатами
                screens.push({
                    id: 'resultScr'+i,
                    view: renderResult(app.results[i]),
                    data: {
                        currentResult: i
                    },
                    group: 'results',
                    collapse: true, // показ экранов всех сразу на одном поле редактирования
                    name: 'Результаты',
                    doWhenInDOM: applyStyles
                });
            }

            makeUidForQuiz();
            state = undefined;
            next();
        }

        /**
         * Функция каждый раз выполняется, когда создается вью из шаблоны
         * для применения динамических стилей
         * Временное решение, не очень хорошее
         *
         */
        function applyStyles(appObject, $elem) {
            var $elem = $elem || document;
            var $w = ($elem.hasClass && $elem.hasClass('wrapper')) ? $elem: $($elem).find('.wrapper');
            if (appObject.showBackgroundImage === true) {
                if (appObject.background) {
                    $w.css('backgroundImage',appObject.background);
                }
                else {
                    $w.css('backgroundImage','none');
                }
            }
            else {
                $w.css('backgroundImage','none');
            }
            if (appObject.backgroundColor) {
                $w.css('backgroundColor',appObject.backgroundColor);
            }
            if (app.fontColor) {
                $('.cnt_wr').css('color',app.fontColor);
            }
            if (app.fontFamily) {
                $('.cnt_wr').css('fontFamily',app.fontFamily);
            }
            $('.js-logo').css('backgroundImage','url('+app.logoUrl+')');
            $('.js-start_logo').css('top',app.logoStartPosition.top+'px').css('left',app.logoStartPosition.left+'px');
            $('.js-result_logo').css('top',app.logoResultPosition.top+'px').css('left',app.logoResultPosition.left+'px');
            $('.t_btn').css('borderRadius',app.buttonBorderRadius+'px');
            $('.t_btn').css('fontSize',app.buttonFontSize+'px');
            $('.t_btn').css('fontFamily',app.buttonFontFamily);
            if (app.showQuestionProgress === true) {
                $('.js-question_progress').show();
            }
            else {
                $('.js-question_progress').hide();
            }
            $('.js-question_progress').css('fontFamily',app.questionProgressFontFamily);
            $('.js-question_progress').css('top',app.questionProgressPosition.top+'px').css('left',app.questionProgressPosition.left+'px');
            $('.js-question_progress').css('fontSize',app.questionProgressFontSize+'px');
            if (app.showBullits === true) {
                $('.bullit').show();
            }
            else {
                $('.bullit').hide();
            }
//            $('.bullit').css('borderWidth',app.bullitsBorderWidth+'px');
        }

        /**
         *
         * @param {string} id - ид экрана
         */
        function getScreen(id) {

        }

        /**
         * Сгенерировать уникальные идишки для вопросов и ответов
         */
        function makeUidForQuiz() {
            for (var j = 0; j < app.quiz.length; j++) {
                for (var i = 0; i < app.quiz[j].options.length; i++) {
                    var o = app.quiz[j].options[i];
                    o.id = MD5.calc(o.text + j + i);
                }
            }
        }

        function renderQuestion(index) {
            currentQuestionIndex = index;
            var q = app.quiz[currentQuestionIndex];
            var $cnt = $('.js-slides_cnt');
            $cnt.empty();
            var templStr = $('#'+q.uiTemplate).html();
            templStr = templStr.replace('{{question_text}}', q.text);
            var $slide = $(templStr);
            if (q.img) {
                $slide.find('.js-photo').css('backgroundImage', 'url('+q.img+')');
            }
            $cnt.append($slide);
            renderAnswers($slide);
            $slide.find('.js-next').click(function() {
                next();
            });
            $slide.find('.js-question_progress').text((currentQuestionIndex+1)+'/'+app.quiz.length);
            applyStyles(app, $slide);
            return $slide;
        }

        function renderAnswers($slide) {
            for (var i = 0; i < app.quiz[currentQuestionIndex].options.length; i++) {
                var o = app.quiz[currentQuestionIndex].options[i];
                var templStr = $('#id-answer_template').html();

                //TODO важно, костыль: пока нет возможности сделать это в движке, сформировать атрибуты при parseView
                // потому что это надо заменять при рендере ответа
//                templStr = templStr.replace('{{currentOption}}', i);
                var re = new RegExp('{{currentOption}}','g');
                templStr = templStr.replace(re, i);

                templStr = templStr.replace('{{answer_options_text}}', o.text);
                var $e = $(templStr);
                $e.attr('data-id', o.id);
                $e.click(function(e) {
                    if (previewMode === false) {
                        currentOptionId = $(e.currentTarget).attr('data-id');
                        var success = answer(currentOptionId);
                        showExplanation($slide, success);
                    }
                });
                $('.js-answers_cnt').append($e);
            }
        }

        /**
         * Отрисовать результат теста
         *
         * @param {object} result - индекс результата из массива app.results
         */
        function renderResult(result) {
            var $cnt = $('#id-end_slide');
            $cnt.empty();
            var templStr = $('#id-result_template').html();
            var $slide = $(templStr);
            $slide.find('.js-result_title').text(result.title);
            $slide.find('.js-result_description').text(result.description);
            $slide.find('.js-restart').text(app.restartButtonText);
            $cnt.append($slide);
            $slide.find('.js-next').click(function() {
                next();
            });
            applyStyles(app, $slide);
            return $slide;
        }

        /**
         * Ответить на текущий вопрос
         * @param id - идентификатор выбранного ответа
         * @returns {boolean}
         */
        function answer(id) {
            for (var i = 0; i < app.quiz[currentQuestionIndex].options.length; i++) {
                var o = app.quiz[currentQuestionIndex].options[i];
                if (o.id === id) {
                    if (o.points !== undefined && o.points > 0) {
                        resultPoints += o.points;
                        return true;
                    }
                }
            }
            return false;
        }

        /**
         * Вернуть по идентификатору опцию ответа
         *
         * @param {string} id - идентификатор опции
         * @param {number} currentQuestionIndex - индекс вопроса
         */
        function getOptionById(id, currentQuestionIndex) {
            for (var i = 0; i < app.quiz[currentQuestionIndex].options.length; i++) {
                var o = app.quiz[currentQuestionIndex].options[i];
                if (o.id === id) {
                    return o;
                }
            }
            return null;
        }

        /**
         * Показать верен ли был ответ или нет
         * Также появляется кнопка Далее, чтобы перейти к следующему вопросу
         *
         * @param success - верно ли ответил пользователь
         */
        function showExplanation($slide, success) {
            var $ex = $('.js-slides_cnt').find('.js-explain');
            // add __err modifier if wrong
            if ($ex) {
                if (success !== true) {
                    $ex.addClass('__err');
                }
                $ex.show();
                if (app.showExplanation === true) {
                    var $explText = $('.js-explanation_text');
                    var option = getOptionById(currentOptionId, currentQuestionIndex);
                    if (option.explanation) {
                        // показать объяснение если есть в варианте ответа
                        $explText.text(option.explanation);
                    }
                    else if (app.quiz[currentQuestionIndex].explanation) {
                        // показать объяснение если есть в вопросе
                        $explText.text(app.quiz[currentQuestionIndex].explanation);
                    }
                }
            }
        }

        /**
         * Перемешивает элементу массива
         * @param array
         * @returns {*}
         */
        function shuffle(array) {
            var currentIndex = array.length, temporaryValue, randomIndex;
            // While there remain elements to shuffle...
            while (0 !== currentIndex) {
                // Pick a remaining element...
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1;
                // And swap it with the current element.
                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }
            return array;
        }

        $(document).ready(function() {
            start();
        });
    </script>
    <script type="text/javascript" src="descriptor.js"></script>
</body>
</html>